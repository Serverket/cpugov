#!/bin/bash
# cpugov — Toggle or set CPU governor between performance and powersave
# Usage:
#   cpugov              → Show current governor
#   cpugov toggle       → Toggle between performance ↔ powersave
#   cpugov performance  → Set to performance
#   cpugov powersave    → Set to powersave

set -euo pipefail

BOLD="\033[1m"
GREEN="\033[1;32m"
YELLOW="\033[1;33m"
CYAN="\033[1;36m"
RED="\033[1;31m"
RESET="\033[0m"

get_governor() {
    cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
}

set_governor() {
    local gov="$1"
    echo "$gov" | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor > /dev/null
    echo -e "${GREEN}✔${RESET} CPU governor set to ${BOLD}${gov}${RESET}"
}

show_status() {
    local current
    current=$(get_governor)
    local color="$YELLOW"
    [[ "$current" == "performance" ]] && color="$GREEN"
    echo -e "${CYAN}⚡ CPU Governor:${RESET} ${color}${BOLD}${current}${RESET}"
}

case "${1:-}" in
    "")
        show_status
        ;;
    toggle)
        current=$(get_governor)
        if [[ "$current" == "powersave" ]]; then
            set_governor performance
        else
            set_governor powersave
        fi
        ;;
    performance|powersave)
        set_governor "$1"
        ;;
    *)
        echo -e "${RED}Usage:${RESET} cpugov [toggle|performance|powersave]"
        exit 1
        ;;
esac
